# AGV调度控制界面

一个基于Qt的AGV（自动导引车）控制界面程序，支持车辆控制、地图显示和轨迹绘制。

## 功能特性

- **车辆属性管理**：4轮AGV车辆模型，包含长度、宽度、轴距等属性
- **地图管理**：方形空间地图，可自定义大小
- **多种控制算法**：
  - **算法1：先旋转再前进** - 先原地调整角度，再直线前进（适合精确导航）
  - **算法2：边旋转边前进** - 同时进行旋转和前进运动，智能选择前进/后退（适合快速导航）
  - **算法3：PID控制** - 成熟的双PID控制器，精度高、稳定性好（推荐）
  - **算法4：Pure Pursuit** - 纯跟踪算法，适合路径跟踪和自动驾驶场景
- **目标角度控制**：支持设置目标位置和目标角度，车辆到达后会以指定角度停好
- **智能路径规划**：算法2会自动判断应该前进还是后退，选择最优路径
- **实时轨迹显示**：显示车辆运动每一帧的轨迹
- **交互式界面**：
  - 左键点击地图：设置目标位置
  - 右键点击地图：设置目标角度（从车辆当前位置指向点击位置的角度）
  - 下拉菜单切换算法模式
  - 手动输入目标角度

## 编译要求

- CMake 3.16 或更高版本
- Qt 5 或 Qt 6
- C++17 编译器

## 编译步骤

### Windows - 快速开始（推荐）

**最简单的方法：使用构建脚本**

1. **安装CMake**（如果还没有）：
   - 访问 https://cmake.org/download/
   - 下载并安装，**务必勾选** "Add CMake to system PATH"
   - 重新打开命令行窗口

2. **运行构建脚本**：
   ```powershell
   # PowerShell
   .\build.ps1
   
   # 或 CMD
   build.bat
   ```
   
   脚本会自动查找Qt并编译项目。

### Windows - 手动构建

**如果你的Qt安装在 `C:\Qt\Qt5.9.0`：**

```powershell
# 创建build目录
mkdir build
cd build

# 配置项目（根据你的编译器选择路径）
# VS2017:
cmake .. -DCMAKE_PREFIX_PATH="C:/Qt/Qt5.9.0/5.9/msvc2017_64"
# 或 VS2015:
cmake .. -DCMAKE_PREFIX_PATH="C:/Qt/Qt5.9.0/5.9/msvc2015_64"
# 或 VS2013:
cmake .. -DCMAKE_PREFIX_PATH="C:/Qt/Qt5.9.0/5.9/msvc2013_64"

# 编译
cmake --build . --config Release
```

**如果你的Qt是其他版本：**

```bash
mkdir build
cd build
cmake .. -DCMAKE_PREFIX_PATH="C:/Qt/你的Qt版本/msvc编译器版本"
cmake --build . --config Release
```

**注意：**
- 路径使用 `/` 而不是 `\`
- 路径用引号括起来
- 确保Qt路径下有 `include` 和 `lib` 目录

### 使用Qt Creator（最简单）

1. 打开Qt Creator
2. 文件 -> 打开文件或项目
3. 选择 `CMakeLists.txt`
4. 配置构建路径
5. 点击"构建"按钮

**详细说明请查看 [docs/构建说明.md](docs/构建说明.md)**

### Linux

```bash
# 安装Qt开发包（Ubuntu/Debian）
sudo apt-get install qt6-base-dev qt6-base-dev-tools

mkdir build
cd build
cmake ..
make
```

### macOS

```bash
# 使用Homebrew安装Qt
brew install qt@6

mkdir build
cd build
cmake .. -DCMAKE_PREFIX_PATH="$(brew --prefix qt@6)"
make
```

## 使用方法

1. 运行程序后，会显示一个地图窗口
2. **设置目标点**：
   - **左键点击**：在地图上点击任意位置，车辆会自动导航到该点
   - **右键点击**：设置目标角度（从车辆当前位置指向点击位置的角度）
   - **手动输入**：在"目标角度"输入框中直接输入角度值（-180°到180°）
3. **切换算法**：在"算法"下拉菜单中选择控制算法
   - **先旋转再前进**：车辆会先原地旋转到正确方向，再前进
   - **边旋转边前进**：车辆会边旋转边前进，更高效
4. **清除轨迹**：点击"清除轨迹"按钮清除已绘制的轨迹
5. **重置车辆**：点击"重置车辆"按钮将车辆重置到地图中心
6. **设置地图大小**：在控制面板中设置地图的宽度和高度

## 控制算法说明

程序实现了4种控制算法，可根据需要切换：

### 算法1：先旋转再前进
- 当角度误差较大时，车辆先原地旋转调整方向
- 角度正确后，车辆直线前进
- 如果设置了目标角度，接近目标时会调整到目标角度
- **优点**：路径简单，适合精确导航
- **缺点**：可能需要在原地旋转，效率较低

### 算法2：边旋转边前进
- 车辆同时进行旋转和前进运动
- 智能判断应该前进还是后退（类似汽车倒车）
- 如果设置了目标角度，会综合考虑位置和角度
- **优点**：运动流畅，效率高
- **缺点**：路径可能更复杂

### 算法3：PID控制（推荐）⭐
- 使用两个独立的PID控制器分别控制线速度和角速度
- 工业标准算法，精度高、响应快、稳定性好
- 支持积分和微分项，消除稳态误差，减少超调
- **优点**：控制精度高，稳定性好，工业常用
- **缺点**：需要调参

### 算法4：Pure Pursuit（纯跟踪算法）
- 基于几何路径跟踪的前瞻点算法
- 通过计算前瞻点来控制车辆转向
- 适合路径跟踪和自动驾驶场景
- **优点**：路径跟踪平滑，几何直观
- **缺点**：需要路径点

**详细算法说明请查看 [docs/算法说明.md](docs/算法说明.md)**

## 车辆运动学模型

程序使用 **Ackermann转向模型**（4轮车标准物理模型）：
- 考虑轴距和转向角的物理约束
- 符合实际4轮车的转向机制
- 支持转向角限制，避免不合理的运动

**详细运动学模型说明请查看 [docs/运动学模型说明.md](docs/运动学模型说明.md)**

## 项目结构

```
MAPF-AGV/
├── CMakeLists.txt          # CMake配置文件
├── README.md               # 项目说明
├── build.bat               # Windows构建脚本（CMD）
├── build.ps1                # Windows构建脚本（PowerShell）
├── .gitignore              # Git忽略文件
├── docs/                   # 文档目录
│   ├── 算法说明.md         # 控制算法详细说明
│   ├── 运动学模型说明.md   # 车辆运动学模型说明
│   └── 构建说明.md         # 构建详细说明
└── src/                    # 源代码目录
    ├── main.cpp            # 程序入口
    ├── core/               # 核心模块
    │   ├── vehicle.h       # 车辆类头文件
    │   ├── vehicle.cpp     # 车辆类实现
    │   ├── map.h           # 地图类头文件
    │   └── map.cpp         # 地图类实现
    ├── control/            # 控制模块
    │   ├── controller.h    # 控制器头文件
    │   └── controller.cpp # 控制器实现
    └── ui/                 # UI模块
        ├── mainwindow.h    # 主窗口头文件
        ├── mainwindow.cpp  # 主窗口实现
        ├── mapwidget.h     # 地图绘制组件头文件
        └── mapwidget.cpp   # 地图绘制组件实现
```

## 技术特点

- 使用Qt框架实现GUI界面
- 实时绘制车辆、地图和轨迹
- 支持坐标转换（世界坐标 ↔ 屏幕坐标）
- 运动学模型：基于Ackermann转向模型的4轮车控制
- 实时状态显示

